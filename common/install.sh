SYSPROP="$MODPATH"/system.prop; PERPROP="$MODPATH"/persist.prop; POSTFS="$MODPATH"/post-fs-data.sh; SERV="$MODPATH"/service.sh; { ! $KSU && [ "$(echo "$MAGISK_VER" | awk -F- '{print $NF}')" != "delta" ] && [ "$(echo "$MAGISK_VER" | awk -F- '{print $NF}')" != "kitsune" ]; } && { sed -i -e "1i\\mf() {\n  local sd=\\\"\\\$1\\\"; local td=\\\"\\\$2\\\"\n  [ ! -d \\\"\\\$sd\\\" ] && return\n  find \\\"\\\$sd\\\" -type f | while read -r f; do\n    rp=\\\"\\\${f#\\\$sd}\\\"; tf=\\\"\\\$td\\\$rp\\\"; mount -o bind \\\"\\\$f\\\" \\\"\\\$tf\\\"\n  done\n}\nfor part in $PARTITIONS; do\n  pn=\\\"\\\${part#/}\\\"; sd=\\\"\\\$MODDIR/\\\$pn\\\"; td=\\\"/\\\$pn\\\"; mf \\\"\\\$sd\\\" \\\"\\\$td\\\"\ndone" "$POSTFS" || PARTITIONS="/my_product /my_region /my_stock"; sed -i -e "1i\\mf() {\n  local sd=\\\"\\\$1\\\"; local td=\\\"\\\$2\\\"\n  [ ! -d \\\"\\\$sd\\\" ] && return\n  find \\\"\\\$sd\\\" -type f | while read -r f; do\n    rp=\\\"\\\${f#\\\$sd}\\\"; tf=\\\"\\\$td\\\$rp\\\"; mount -o bind \\\"\\\$f\\\" \\\"\\\$tf\\\"\n  done\n}\nfor part in $PARTITIONS; do\n  pn=\\\"\\\${part#/}\\\"; sd=\\\"\\\$MODDIR/\\\$pn\\\"; td=\\\"/\\\$pn\\\"; mf \\\"\\\$sd\\\" \\\"\\\$td\\\"\ndone" "$POSTFS"; }; [ -n "$(find /data/app/ -type f -name "libzako*.so")" ] && { mkdir -p "$MODPATH"/system; mv "$MODPATH"/odm "$MODPATH"/system; }
